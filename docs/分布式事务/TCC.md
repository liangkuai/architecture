# TCC（补偿事务）

如果说 2PC 和 3PC 都是数据库层面的分布式事务方案，也就是只涉及数据库操作；那么 TCC 就是业务层面的分布式事务，还包括推送等等。

TCC 指的是 Try-Confirm-Cancel，
- Try，预留，资源的预留和锁定
- Confirmm，确认，执行操作
- Cancel，撤销，把预留阶段的动作撤销

TCC 其实就是采用的补偿机制，其核心思想是：针对每个操作，都要注册一个与其对应的确认和补偿（撤销）操作。


### 步骤

#### Try 阶段
主要是对业务系统做检测及资源预留

#### Confirm 阶段
主要是对业务系统做确认提交，Try 阶段执行成功并开始执行 Confirm 阶段时，默认 Confirm 阶段是不会出错的。即：只要 Try 成功，Confirm 一定成功。

#### Cancel 阶段
主要是在业务执行错误，需要回滚的状态下执行的业务取消，预留资源释放。





### 优点
跟 2PC 比起来，实现以及流程相对简单了一些，但数据的一致性比 2PC 也要差一些。


### 缺点
缺点还是比较明显的，在 2、3 步中都有可能失败。

TCC 属于应用层的一种补偿方式，所以需要程序员在实现的时候多写很多补偿的代码，在一些场景中，一些业务流程可能用 TCC 不太好定义及处理。