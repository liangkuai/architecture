# CAP 定理

> 1998年，加州大学的计算机科学家 Eric Brewer 对分布式系统的特性做了高度抽象，抽象成了三种特性：
> - Consistency（一致性）
> - Availability（可用性）
> - Partition tolerance（分区容错性）
>
> 并且这三个特性不可能同时做到，最多只能同时满足其中两个。这个结论就叫做 CAP 定理。

#### 1. 一致性
一致性说的是客户端的每次读操作，不管访问哪个节点，要么读到的都是同一份数据，要么读取失败。

可以把一致性看作是分布式系统对访问本系统的客户端的一种承诺：不管你访问哪个节点，要么我给你返回的都是绝对一致的数据，要么你都读取失败。**一致性强调的是各节点间的数据一致。**

#### 2. 可用性
可用性说的是任何来自客户端的请求，不管访问哪个节点，都能得到响应数据，但不保证是同一份数据。

可以把可用性看作是分布式系统对访问本系统的客户端的另外一种承诺：我尽力给你返回数据，不会不响应你，但是我不保证每个节点给你的数据都是最新的。**强调的是服务可用，但不保证数据的一致。**

#### 3. 分区容错性
分区容错性说的是当节点间出现任意数量的消息丢失或高延迟的时候，系统仍然可以继续提供服务。

可以把分区容错性看作是分布式系统在告诉访问本系统的客户端：不管我的内部出现什么样的数据同步问题，我会一直运行，提供服务。**强调的是集群对分区故障的容错能力。**

> 因为分布式系统与单机系统不同，它涉及到多节点间的通讯和交互，节点间的分区故障是必然发生的，所以在分布式系统中分区容错性是必须要考虑的。

现在了解了一致性、可用性和分区容错性，那么在设计分布式系统时，是选择一致性？还是可用性？还是分区容错性？还是都可以选择呢？这三个特性有什么冲突吗？这些问题就与 “CAP 不可能三角” 有关。

> #### CAP 不可能三角
>
> CAP 不可能三角说的是对于一个分布式系统而言，一致性、可用性、分区容错性 3 个指标不可兼得，只能在 3 个指标中选择 2 个。

### 如何使用 CAP 理论？

我们都知道，只要有网络交互就一定会有延迟和数据丢失，而这种状况我们必须接受，还必须保证系统不能挂掉。所以节点间的分区故障是必然发生的。也就是说，**分区容错性（P）是前提，是必须要保证的。**

现在就只剩下一致性（C）和可用性（A）可以选择了：
- 要么选择一致性，保证数据绝对一致；
- 要么选择可用性，保证服务可用。

那么 CP 和 AP 的含义是什么呢？

#### 1. CP 模型
当选择了一致性（C）的时候，如果因为消息丢失、延迟过高发生了网络分区，那么这个时候，当集群节点接收到来自客户端的写请求时，因为无法保证所有节点都是最新信息，所以系统将返回写失败错误，也就是说集群拒绝新数据写入。

#### 2. AP 模型
当选择了可用性（A）的时候，系统将始终处理客户端的查询，返回特定信息，如果发生了网络分区，一些节点将无法返回最新的特定信息，它们将返回自己当前的相对新的信息。


### 参考
- [CAP 定理的含义 - 阮一峰](http://www.ruanyifeng.com/blog/2018/07/cap.html)