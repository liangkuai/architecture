# ZNode

ZNode 是最小的数据单元，每个 ZNode 上都可以，

- 保存数据
- 挂载子节点

因此可以构成了一个树形的存储结构，与 Unix 文件系统类似。

![数据模型](/assets/images/zk/znode.jpeg)



### 1. 节点类型

不同类型的数据节点有不同的生命周期。节点类型可以分为四类，

- 持久
    - 持久节点
    - 持久顺序节点
- 临时
    - 临时节点
    - 临时顺序节点

#### 1.1 持久节点

持久节点是指一旦这个 ZNode 被创建了，除非主动删除，否则这个 ZNode 会一直保存在 Zookeeper 上。

#### 1.2 持久顺序节点

持久顺序节点的基本特性和持久节点是一致的，额外的特性表现在顺序性上。

在 ZooKeeper 中，每个父节点都会为它的第一级子节点维护一份顺序，用于记录下每个子节点创建的先后顺序。

基于这个顺序特性，在创建子节点的时候，可以设置这个标记，那么在创建节点过程中，ZooKeeper 会自动为给定节点加上一个数字后缀，作为一个新的、完整的节点名。

#### 1.3 临时节点

临时节点的生命周期和客户端会话绑定，**一旦客户端会话失效**，那么这个客户端创建的所有临时节点都会被移除。

> **ZooKeeper 规定不能基于临时节点来创建子节点，即临时节点只能作为叶子节点。**

#### 1.4 临时顺序节点

类似于持久顺序节点。在临时节点的基础上，添加了顺序的特性。


### 2. 节点内容

#### 2.1 节点数据

> ZooKeeper 是为读多写少的场景所设计。ZNode 并不是用来存储大规模业务数据，而是用于存储少量的状态和配置信息，**每个节点的数据最大不能超过 1 MB**。

#### 2.2 节点状态信息 - Stat 结构

| field | 含义 |
| :--- | :--- |
| czxid | Create ZXID，节点被创建时的事务 ID |
| mzxid | Modified ZXID，节点最后一次被更新时的事务 ID |
| ctime | Create Time |
| mtime | Modified Time |
| version | 节点版本号 |
| cversion | 子节点的版本号 |
| aversion | 节点的 ACL 版本号 |
| ephemeraOwner | 创建该临时节点的 sessionID。如果是持久节点，值为 0 |
| dataLength | 数据内容长度 |
| numChildren | 子节点个数 |
| pzxid | 子节点列表最后一次被修改时的事务 ID。（不是子节点内容） |
