# 限流、降级、熔断篇

### 限流
一个服务挂掉后，上游服务或者用户一般会习惯性地重试访问。这导致一旦服务恢复正常，很可能因为瞬间网络流量过大又立刻挂掉。因此服务需要能够自我保护 —— 限流。

限流策略有很多，最简单的比如当单位时间内请求数过多时，丢弃多余的请求。另外，也可以考虑分区限流。仅拒绝来自产生大量请求的服务的请求。例如商品服务和订单服务都需要访问促销服务，商品服务由于代码问题发起了大量请求，促销服务则只限制来自商品服务的请求，来自订单服务的请求则正常响应。



---
### 降级
当下游服务停止工作后，如果该服务并非核心业务，那么上游服务应该降级，以保证核心业务不中断。

比如，下单界面有一个推荐商品凑单的功能，当推荐模块挂了后，下单功能不能一起挂掉，只需要暂时关闭推荐功能即可。



---
### 熔断
当一个服务因为各种原因停止响应时，调用方通常会等待一段时间，然后超时或者收到错误返回。如果调用链路比较长，可能会导致请求堆积，整条链路占用大量资源一直在等待下游响应。所以当多次访问一个服务失败时，应该熔断，标记该服务已停止工作，直接返回错误。直至该服务恢复正常后再重新建立连接。







### 参考
- [一文详解微服务架构 - 古霜卡比](https://www.cnblogs.com/skabyy/p/11396571.html)